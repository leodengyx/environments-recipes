#==============================================================================
# vim: softtabstop=2 shiftwidth=2 expandtab fenc=utf-8 cc=81 tw=80
#==============================================================================
#
# DESCRIPTION: Debian 8 (Jessie) base system built with virtualbox.
#
#==============================================================================
---
extend: ../from_scratch/debian8.yaml
#== Global variables use by Kameleon engine and the steps
global:
  qemu_image_size: 15G
  qemu_cpu: 4
  qemu_memory_size: 4096
  bootstrap_packages: >-
     linux-image-$${debian_kernel_arch} isc-dhcp-client isc-dhcp-common ifupdown iptables iproute2 iputils-ping openssh-server locales
  appliance_formats: qcow2 tar.gz
  appliance_tar_excludes: >-
    ./etc/fstab ./root/.bash_history ./root/kameleon_workdir
    ./var/tmp/* ./tmp/* ./var/log/* ./dev/* ./proc/* ./run/*
    ./sys/*
#  input: $${virtualbox_image_disk}
  # G5k variables
  variant: min # default value for variant. Can be overwritten by --global=variant:<my_variant> when calling kameleon
  os_family: debian
  os_release: jessie
  image_version: 2016122311
  output: "$${kameleon_cwd}/$${kameleon_recipe_name}" # output files basename
  g5k_tgz_path: server:///path/to/your/image
  g5k_postinst_path: server:///grid5000/postinstalls/debian-x64-min-1.2-post.tgz
  arg_create: --basefolder /tmp
  kernel_arch: amd64
  apt_repository: http://ftp.debian.org/debian/
  apt_enable_contrib: true
  apt_enable_nonfree: true


bootstrap:
  - "@base"

setup:
   # Install
  - configure_apt:
    - repository: $${apt_repository}
    - enable_contrib_repo: $${apt_enable_contrib}
    - enable_nonfree_repo: $${apt_enable_nonfree}
  - install_bootloader
  - clean_udev_dir
  - set_capabilities
  - setup_orchestrator
  - run_orchestrator

export:
  - disable_checkpoint
  - "@base"
  - export_g5k
